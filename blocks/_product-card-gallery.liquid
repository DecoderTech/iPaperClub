

{% assign has_applied_colour_filter = false %}
{% if collection.filters %}
  {% for filter in collection.filters %}
    {% if filter.type == 'list' and filter.param_name contains 'color' %}
      {% if filter.active_values.size > 0 %}
        {% assign has_applied_colour_filter = true %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

{% capture children %}
  {% unless closest.product == blank %}
    {% render 'product-card-badges', product: closest.product %}
    {%  if settings.quick_add or settings.mobile_quick_add %}
      {% render 'quick-add', product: closest.product, section_id: section.id %}
    {% endif %}
  {% endunless %}
{% endcapture %}

{% liquid
  assign is_frame_product = false
  
  # Check product type
  if closest.product.type contains 'Quadro' or closest.product.type contains 'quadro'
    assign is_frame_product = true
  endif

  # Check tags
  unless is_frame_product
    for tag in closest.product.tags
      assign tag_down = tag | downcase
      if tag_down contains 'quadro'
        assign is_frame_product = true
        break
      endif
    endfor
  endunless

  # Check options (like in PDP)
  unless is_frame_product
    for option in closest.product.options_with_values
      assign option_name = option.name | downcase
      if option_name contains 'moldura'
        assign is_frame_product = true
        break
      endif
      
      for value in option.values
        assign value_down = value | downcase
        if value_down contains 'preta' or value_down contains 'branca' or value_down contains 'madeira'
          assign is_frame_product = true
          break
        endif
      endfor
      if is_frame_product
        break
      endif
    endfor
  endunless
%}

{% if is_frame_product %}
  {% liquid
    assign target_media = closest.product.featured_media
    if target_media == blank and closest.product.media.size > 0
      assign target_media = closest.product.media.first
    endif
  %}
  {% if target_media != blank %}
    <div class="frame-preview frame-preview--white frame-preview--card">
      <div class="frame-preview__inner">
        {% render 'product-media', media: target_media, preview_image_only: true, loading: 'lazy' %}
      </div>
      <img
        class="frame-preview__frame-image"
        src="https://cdn.shopify.com/s/files/1/0665/4636/8579/files/moldura_white.png?v=1768429538"
        alt=""
        loading="lazy"
      >
    </div>
  {% endif %}
{% else %}
  {% render 'card-gallery', children: children, has_applied_colour_filter: has_applied_colour_filter %}
{% endif %}

{% # Title and price for the zoomed out grid view %}
<div class="product-grid-view-zoom-out--details">
  {% if closest.product == blank %}
    <h3 class="h4">{{ 'content.product_card_placeholder' | t }}</h3>
  {% else %}
    <h3 class="h4">{{ closest.product.title }}</h3>
    <div class="h6">
      <product-price data-product-id="{{ closest.product.id }}">
        {% render 'price', product_resource: closest.product, show_unit_price: false %}
      </product-price>
    </div>
  {% endif %}
</div>

{% stylesheet %}
  .frame-preview--card {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: #ffffff;
  }

  /* Aspect ratio fix for frames */
  .frame-preview--card.frame-preview--ratio {
    aspect-ratio: 0.707; /* Approx 1:1.414 (A series) or 5:7 */
    height: auto !important;
    min-height: auto !important;
  }

  .frame-preview--card .frame-preview__inner {
    box-sizing: border-box;
    width: 100%;
    height: 100%;
    padding: 5.45% 11.25%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .frame-preview--card .frame-preview__inner .product-media {
    width: 100%;
    height: auto;
    padding: 0;
    aspect-ratio: auto;
  }

  .frame-preview--card .frame-preview__inner .product-media__image {
    width: 100%;
    height: auto;
    object-fit: contain;
  }

  .frame-preview--card .frame-preview__frame-image {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    object-fit: contain;
  }

  @media screen and (max-width: 749px) {
    .product-grid__card .frame-preview--card {
      height: 260px;
    }
  }

  @media screen and (min-width: 750px) {
    .product-grid__card .frame-preview--card {
      height: 340px;
    }

    .frame-preview--card .frame-preview__inner .product-media {
      max-width: 100%;
      max-height: 100%;
    }

    .frame-preview--card .frame-preview__inner .product-media__image {
      width: auto;
      height: auto;
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.product_image",
  "tag": null,
  "settings": [
    {
      "type": "paragraph",
      "content": "t:content.resource_reference_product_media"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:options.auto"
        },
        {
          "value": "portrait",
          "label": "t:options.portrait"
        },
        {
          "value": "square",
          "label": "t:options.square"
        },
        {
          "value": "landscape",
          "label": "t:options.landscape"
        }
      ],
      "default": "portrait",
      "label": "t:settings.aspect_ratio",
      "info": "t:info.aspect_ratio_adjusted"
    },
    {
      "type": "header",
      "content": "t:content.borders"
    },
    {
      "type": "select",
      "id": "border",
      "label": "t:settings.style",
      "options": [
        {
          "value": "none",
          "label": "t:options.none"
        },
        {
          "value": "solid",
          "label": "t:options.solid"
        }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:settings.thickness",
      "default": 1,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "t:settings.opacity",
      "default": 100,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "t:settings.border_radius",
      "min": 0,
      "max": 32,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "t:names.product_card_media",
      "category": "t:categories.product"
    }
  ]
}
{% endschema %}
